<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced RAG – Admin Dashboard</title>
    <style>
      :root {
        --bg: #0b0f19;
        --panel: #121826;
        --muted: #94a3b8;
        --text: #e2e8f0;
        --accent: #4f46e5;
        --accent-2: #22c55e;
        --border: #243044;
      }
      * { box-sizing: border-box; }
      body { margin: 0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      header { padding: 24px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(79,70,229,.15), transparent); }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
      h1 { margin: 0; font-size: 22px; letter-spacing: .3px; }
      .subtitle { color: var(--muted); margin-top: 6px; font-size: 13px; }
      .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
      .card { grid-column: span 6; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
      .card.full { grid-column: 1 / -1; }
      .card h3 { margin: 0 0 8px; font-size: 16px; }
      .muted { color: var(--muted); font-size: 13px; }
      input[type="text"], input[type="file"], textarea { width: 100%; background: #0f172a; color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; font-size: 14px; }
      button { appearance: none; background: var(--accent); color: white; border: 0; padding: 10px 14px; border-radius: 8px; font-weight: 600; cursor: pointer; }
      button.secondary { background: #1f2937; border: 1px solid var(--border); color: var(--text); }
      .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      pre { background: #0f172a; color: #e5e7eb; border: 1px solid var(--border); border-radius: 8px; padding: 12px; overflow-x: auto; font-size: 12px; }
      a { color: #93c5fd; text-decoration: none; }
      a:hover { text-decoration: underline; }
      @media (max-width: 860px) { .card { grid-column: 1 / -1; } }
    </style>
  </head>
  <body>
    <header>
      <div class="wrap">
        <h1>Advanced RAG – Admin Dashboard</h1>
        <div class="subtitle">Manage ingestion and monitor your RAG service.</div>
      </div>
    </header>
    <div class="wrap">
      <div class="grid">
        <div class="card">
          <h3>System Health</h3>
          <p class="muted">Check API availability and time.</p>
          <div class="row">
            <button class="secondary" onclick="checkHealth()">Check Health</button>
            <a href="/metrics" target="_blank">View Metrics</a>
          </div>
          <pre id="health_out">Click "Check Health" to fetch status.</pre>
        </div>
        <div class="card">
          <h3>Quick Query</h3>
          <p class="muted">Test your deployment with a sample query.</p>
          <input id="qq_text" type="text" placeholder="e.g., Summarize the uploaded PDFs." />
          <div style="margin-top:8px" class="row">
            <button onclick="runQuery()">Run Query</button>
          </div>
          <pre id="qq_out">Answer and top citation will appear here.</pre>
        </div>

        <div class="card full">
          <h3>Ingest Files</h3>
          <p class="muted">Upload documents (PDF, DOCX, XLSX, CSV, TXT, Images) for ingestion.</p>
          <input id="files" type="file" multiple accept=".pdf,.docx,.xlsx,.csv,.txt,image/*" />
          <div style="margin-top:8px" class="row">
            <button onclick="uploadFiles()">Upload & Ingest</button>
          </div>
          <pre id="upload_result">—</pre>
        </div>

        <div class="card full">
          <h3>Ingest Directory</h3>
          <p class="muted">Scan and ingest a server-side directory. Default: ./data/uploads</p>
          <div class="row">
            <input id="dir_path" placeholder="./data/uploads" value="./data/uploads" />
            <button onclick="ingestDir()">Ingest Directory</button>
          </div>
          <pre id="dir_result">—</pre>
        </div>
      </div>
    </div>

    <script>
      async function uploadFiles(){
        const input = document.getElementById('files');
        if(!input.files || input.files.length === 0){
          alert('Select one or more files');
          return;
        }
        const fd = new FormData();
        for(const f of input.files){ fd.append('files', f); }
        const res = await fetch('/api/ingest/upload', { method: 'POST', body: fd });
        const txt = await res.text();
        document.getElementById('upload_result').textContent = txt;
      }

      async function ingestDir(){
        const path = document.getElementById('dir_path').value || './data/uploads';
        const fd = new FormData();
        fd.append('path', path);
        const res = await fetch('/api/ingest/directory', { method: 'POST', body: fd });
        const txt = await res.text();
        document.getElementById('dir_result').textContent = txt;
      }

      async function checkHealth(){
        try{
          const res = await fetch('/api/health');
          const json = await res.json();
          document.getElementById('health_out').textContent = JSON.stringify(json, null, 2);
        }catch(e){
          document.getElementById('health_out').textContent = String(e);
        }
      }

      async function runQuery(){
        const q = document.getElementById('qq_text').value || 'Summarize the uploaded PDFs.';
        try{
          const res = await fetch('/api/query', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: q, top_k: 5, filters: {} })
          });
          const json = await res.json();
          const ans = json?.answer?.content || '';
          const c = (json?.citations && json.citations[0]) ? json.citations[0] : null;
          const cite = c ? `${c.document}${c.pages && c.pages.length ? ' (page ' + c.pages[0] + ')' : ''}` : '—';
          document.getElementById('qq_out').textContent = `Answer:\n${ans}\n\nTop citation: ${cite}`;
        }catch(e){
          document.getElementById('qq_out').textContent = String(e);
        }
      }
    </script>
  </body>
  </html>


